var V=Object.defineProperty;var q=(c,t,e)=>t in c?V(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var O=(c,t,e)=>q(c,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=e(r);fetch(r.href,o)}})();class G{constructor(t,e,i={width:0,height:0},r=!0){O(this,"_config");O(this,"_Element",null);this._source=t,this._target=e,this._margin=i,this._useInline=r,this._config={fonts:{size:3,family:"sans-serif",unit:"px"},textColor:"rgb(85, 85, 85)",lineWidth:.18,strokeColor:"rgb(85, 85, 85)",paperColor:"rgb(233, 229, 229)",mainInnerColor:"lightgreen",mainOuterColor:"skyblue",remainInnerColor:"lightcoral",remainOuterColor:"lightsalmon",ratio:28.346},this._validateTarget(e,t,i),this._validateSource(t),this._validateMargin(i,t,e),this._margin&&!this._margin.width&&!this._margin.height&&(this._margin={width:0,height:0})}get input(){return{source:this._source,target:this._target,margin:this._margin}}get config(){return this._config}set config(t){this._validateConfig(t),Object.keys(t).forEach(e=>{e in this._config&&(this._config[e]=t[e])})}_buildRectMatrix(t,e,i,r){const o=[];this._validateRectMatrixArray(t);const n={width:i?e.outerSize.height:e.outerSize.width,height:i?e.outerSize.width:e.outerSize.height},d={width:i?e.innerSize.height:e.innerSize.width,height:i?e.innerSize.width:e.innerSize.height},a={width:i?e.marginSize.height:e.marginSize.width,height:i?e.marginSize.width:e.marginSize.height};for(let g=0;g<t.length;g++)for(let s=0;s<t[g].length;s++){let m=t[g][s].grid;m={row:g,column:s};let h=t[g][s].outer;h={x:(r?r.x:0)+s*n.width,y:(r?r.y:0)+g*n.height,width:n.width,height:n.height};let l=t[g][s].inner;l={x:h.x+a.width,y:h.y+a.height,width:d.width,height:d.height},o.push({inner:l,outer:h,grid:m})}return o}_calculateRemain(t,e,i,r){let o,n,d;const a=t.width-e.width,g={width:a,height:t.height},s=t.height-e.height,m={width:t.width,height:s};this._validateRemainXY(a,s);const h=s>=i.width;return a>=i.height?(o=this._crossCut(g,i,r),n={x:e.width,y:0},d={grid:o,start:n}):h?(o=this._crossCut(m,i,r),n={x:0,y:e.height},d={grid:o,start:n}):d=null,d}_inlineCut(t,e,i){this._validateDivisionByZero(e.width+2*i.width),this._validateDivisionByZero(e.height+2*i.height);const r={width:e.width+2*i.width,height:e.height+2*i.height},o=t.width%r.width,n=t.height%r.height,d=(t.width-o)/r.width;return{row:(t.height-n)/r.height,column:d}}_crossCut(t,e,i){this._validateDivisionByZero(e.width+2*i.width),this._validateDivisionByZero(e.height+2*i.height);const r={width:e.width+2*i.width,height:e.height+2*i.height},o=t.width%r.height,n=t.height%r.width,d=(t.width-o)/r.height;return{row:(t.height-n)/r.width,column:d}}_generateLayoutMatrix(t,e){let i,r;this._validateGrid(t);const o=Array(t.row).fill(Array(t.column).fill({inner:{},outer:{},grid:{}}));r=this._buildRectMatrix(o,e);const n={x:0,y:0,width:e.outerSize.width*t.column,height:e.outerSize.height*t.row},d=this._calculateRemain(e.source,n,e.innerSize,e.marginSize);if(d&&d.grid&&d.grid.row>0&&d.grid.column>0){const a=Array(d.grid.row).fill(Array(d.grid.column).fill({inner:{},outer:{},grid:{}}));return i=this._buildRectMatrix(a,e,!0,d.start),{main:r,remain:i??[]}}else return{main:r}}calculate(){var g,s,m,h,l,u;let t,e,i,r=0;const o={width:this._useInline?this._target.width:this._target.height,height:this._useInline?this._target.height:this._target.width},n={width:this._useInline?this._target.width+2*this._margin.width:this._target.height+2*((g=this._margin)==null?void 0:g.height),height:this._useInline?this._target.height+2*this._margin.height:this._target.width+2*((s=this._margin)==null?void 0:s.width)},d={width:this._useInline?(m=this._margin)==null?void 0:m.width:(h=this._margin)==null?void 0:h.height,height:this._useInline?(l=this._margin)==null?void 0:l.height:(u=this._margin)==null?void 0:u.width};this._useInline?e=this._inlineCut(this._source,this._target,this._margin):e=this._crossCut(this._source,this._target,this._margin),this._validateGrid(e);const a={source:this._source,outerSize:n,innerSize:o,marginSize:d};return i=this._generateLayoutMatrix(e,a),Object.keys(i).forEach(w=>{w in i&&(r+=i[w].length)}),t=Object.assign({},i,{total:r}),t}drawCanvas(t=!0){const e=this.config.ratio,i=this._source.width*e,r=this._source.height*e,o=this.config.lineWidth*e,n=this.config.mainOuterColor,d=this.config.mainInnerColor,a=this.config.remainOuterColor,g=this.config.remainInnerColor,s=this.config.paperColor,m=this.config.strokeColor;e>28.346&&alert(`Generated Layout has exceeded the actual size (px to cm).
Image rendering performance will be impacted
due to high Ratio ( >28,346 ).`),this._Element=document.createElement("canvas");const h=this._Element;h.setAttribute("id","calculation-layout"),h.width=i,h.height=r;const l=h.getContext("2d");l.lineWidth=o,l.fillStyle=s,l.beginPath(),l.rect(0,0,i,r),l.fill(),l.strokeStyle=m,l.lineWidth=o,l.stroke(),l.save();try{const u=this.calculate(),w=u.main,f=u.remain;return this._plottingCanvasRectLayout(l,w,0,n,d),f&&this._plottingCanvasRectLayout(l,f,w.length,a,g),l.restore(),t?h.toDataURL("image/jpeg",1):h}catch(u){throw new Error(`Error in drawing process ${u}`)}}_plottingCanvasRectLayout(t,e,i,r,o){var h,l;const n=this.config.ratio,d=this._margin.width*n,a=this._margin.height*n,g=this.config.strokeColor,s=this.config.lineWidth*n,m=this.config.textColor;if(e){if(a>0&&d>0)for(let u=0;u<e.length;u++){const w=e[u].outer,f=w.width*n,p=w.height*n,C=w.x*n,v=w.y*n;t.fillStyle=r,t.beginPath(),t.rect(C,v,f,p),t.fill(),t.strokeStyle=g,t.lineWidth=s,t.stroke(),t.save()}for(let u=0;u<e.length;u++){const w=e[u].inner,f=w.width*n,p=w.height*n,C=w.x*n,v=w.y*n,z=`${this._calculateFontSize(f,p,!0)}${(h=this.config.fonts)==null?void 0:h.unit} ${(l=this.config.fonts)==null?void 0:l.family}`,x=C+f/2,k=v+p/2;t.fillStyle=o,t.beginPath(),t.rect(C,v,f,p),t.fill(),a===0&&d===0&&(t.lineWidth=s,t.strokeStyle=g,t.stroke()),t.font=z,console.log("ctx font",t.font),t.textAlign="center",t.textBaseline="middle",t.fillStyle=m,t.fillText(`${i+u+1}`,x,k),t.save()}}}drawSvg(t=!0){const e=this._source.width,i=this._source.height,r=this.config.paperColor,o=this.config.mainInnerColor,n=this.config.mainOuterColor,d=this.config.remainInnerColor,a=this.config.remainOuterColor,g=this.config.strokeColor,s=`${this.config.lineWidth*3.5}pt`,m=this.config.ratio;this._Element=document.createElementNS("http://www.w3.org/2000/svg","svg");const h=this._Element;h.setAttribute("version","1.1"),h.setAttribute("xmlns","http://www.w3.org/2000/svg"),h.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),h.setAttribute("xml:space","preserve"),h.setAttribute("viewBox",`0 0 ${e*m} ${i*m}`),h.setAttribute("preserveAspectRatio","xMidYMid meet"),h.setAttribute("width",`${e*m}`),h.setAttribute("height",`${i*m}`),h.setAttribute("id","calculation-layout");const l=document.createElementNS("http://www.w3.org/2000/svg","g");l.setAttribute("id","layout");const u=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("id","paper"),u.setAttribute("x","0"),u.setAttribute("y","0"),u.setAttribute("width",`${e*m}`),u.setAttribute("height",`${i*m}`),u.setAttribute("fill",`${r}`),u.setAttribute("anchor","middle"),u.setAttribute("vector-effect","non-scaling-stroke"),u.setAttribute("stroke",g),u.setAttribute("stroke-width",String(s)),u.setAttribute("vector-effect","non-scaling-stroke"),l.appendChild(u);try{const w=this.calculate(),f=w.main,p=w.remain;return h.appendChild(l),p&&h.appendChild(l),this._plottingSvgRectLayout(l,f,0,n,o),p&&this._plottingSvgRectLayout(l,p,f.length,a,d),t?`data:image/svg+xml;charset=utf-8, ${new XMLSerializer().serializeToString(h)}`:h}catch(w){throw new Error(`Error in drawing process ${w}`)}}_plottingSvgRectLayout(t,e,i,r,o){var m;const n=this.config.strokeColor,d=`${this.config.lineWidth*4}pt`,a=this.config.textColor,g=(m=this.config.fonts)==null?void 0:m.family,s=this.config.ratio;for(let h=0;h<e.length;h++){const l=e[h].outer,u=l.width*s,w=l.height*s,f=l.x*s,p=l.y*s,C=e[h].inner,v=C.width*s,R=C.height*s,z=C.x*s,x=C.y*s,k=this._calculateFontSize(v,R);console.log("svg fontsize:",k);const T=z+v/2,P=x+R/2,b=document.createElementNS("http://www.w3.org/2000/svg","rect");b.setAttribute("x",`${f}`),b.setAttribute("y",`${p}`),b.setAttribute("width",`${u}`),b.setAttribute("height",`${w}`),b.setAttribute("fill",r),b.setAttribute("stroke",n),b.setAttribute("stroke-width",String(d)),b.setAttribute("vector-effect","non-scaling-stroke");const y=document.createElementNS("http://www.w3.org/2000/svg","rect");y.setAttribute("x",`${z}`),y.setAttribute("y",`${x}`),y.setAttribute("width",`${v}`),y.setAttribute("height",`${R}`),y.setAttribute("fill",o),y.setAttribute("vector-effect","non-scaling-stroke");const _=document.createElementNS("http://www.w3.org/2000/svg","text");_.setAttribute("x",`${T}`),_.setAttribute("y",`${P}`),_.setAttribute("text-anchor","middle"),_.setAttribute("font-size",`${k*s}`),_.setAttribute("font-family",`${g}`),_.setAttribute("fill",`${a}`),_.textContent=`${i+h+1}`,_.setAttribute("dominant-baseline","middle");const $=document.createElementNS("http://www.w3.org/2000/svg","g");$.setAttribute("id",`cutting-block-${i+h+1}`),$.appendChild(b),$.appendChild(y),$.appendChild(_),t.appendChild($)}return t}reset(){this._Element&&(this._Element=null)}_calculateFontSize(t,e,i=!1){var m,h;const r=this.config.ratio,o=(m=this.config.fonts)==null?void 0:m.size,n=((h=this.config.fonts)==null?void 0:h.size)*1.5,d=Math.min(t,e),a=d*.1;let s=(d-a*2)/2;return s=Math.max(o,Math.min(n,s)),i?s*r:s}_isValidColor(t){const e=new Option().style;return e.color=t,e.color!==""}_validateSource(t){if(isNaN(t.width)||isNaN(t.height))throw new Error("Please provide source width and height.");if(t.width<=0||t.height<=0)throw new Error("Source width and height must be positive values.")}_validateTarget(t,e,i){if(!e&&!t)throw new Error("Please provide source and target size.");if(isNaN(e.width)||isNaN(e.height)||isNaN(t.width)||isNaN(t.height))throw new Error("Incorrect input value! The input must contain a number greater than 0.");if(t.width<=0||t.height<=0)throw new Error("Target width and height must be positive values.");if(t.width+2*i.width>e.width||t.height+2*i.height>e.height)throw new Error("Target size is too large for the source with margin.")}_validateMargin(t,e,i){if(t.width<0||t.height<0)throw new Error("Margin width and height must be non-negative values.");if(i.width+2*t.width>e.width||i.height+2*t.height>e.height)throw new Error("Margin values are too large")}_validateConfig(t){if(t.lineWidth&&t.lineWidth<=0)throw new Error("lineWidth must be positive number");if(t.paperColor&&!this._isValidColor(t.paperColor))throw new Error("paperColor has invalid value");if(t.strokeColor&&!this._isValidColor(t.strokeColor))throw new Error("strokeColor has invalid value");if(t.textColor&&!this._isValidColor(t.textColor))throw new Error("textColor has invalid value");if(t.mainOuterColor&&!this._isValidColor(t.mainOuterColor))throw new Error("mainOuterColor has invalid value");if(t.mainInnerColor&&!this._isValidColor(t.mainInnerColor))throw new Error("mainInnerColor has invalid value");if(t.remainOuterColor&&!this._isValidColor(t.remainOuterColor))throw new Error("remainOuterColor has invalid value");if(t.remainInnerColor&&!this._isValidColor(t.remainInnerColor))throw new Error("remainInnerColor has invalid value");if(isNaN(t.ratio))throw new Error("invalid value! ratio must be a number");Number(t.ratio)>28.346&&console.warn(`Generated Layout has exceeded the actual size (px to cm).
Image rendering performance will be impacted
due to high Ratio ( >28.346 ).`)}_validateRectMatrixArray(t){if(!t||!Array.isArray(t)||t.length===0)throw new Error("rectMatrixArray is empty or undefined or not an array");if(t[0].length===0)throw new Error("rectMatrixArray is empty")}_validateGrid(t){if(t.row<=0)throw new Error("the number of rows in grid cannot be zero or negative number");if(t.column<=0)throw new Error("the number of columns in grid cannot be zero or negative number")}_validateDivisionByZero(t){if(t===0)throw new Error("Division by zero")}_validateRemainXY(t,e){if(t<0)throw new Error("there is a negative remainX");if(e<0)throw new Error("there is a negative remainY")}}const j=document.getElementById("calculate-button"),H=document.getElementById("reset-button"),E=document.getElementById("calculation-form"),W=document.getElementById("paper-colorpicker"),B=document.getElementById("main-inner-colorpicker"),M=document.getElementById("remain-inner-colorpicker"),D=document.getElementById("main-outer-colorpicker"),F=document.getElementById("remain-outer-colorpicker"),N=document.getElementById("select-function"),S=document.getElementById("drawing"),I=document.getElementById("image-container"),A=document.getElementById("download-link");function X(c){var t,e,i,r,o,n;(t=E.querySelector("#source-width"))==null||t.setAttribute("value",c?c.source.width.toString():""),(e=E.querySelector("#source-height"))==null||e.setAttribute("value",c?c.source.height.toString():""),(i=E.querySelector("#target-width"))==null||i.setAttribute("value",c?c.target.width.toString():""),(r=E.querySelector("#target-height"))==null||r.setAttribute("value",c?c.target.height.toString():""),(o=E.querySelector("#margin-width"))==null||o.setAttribute("value",c?c.margin.width.toString():""),(n=E.querySelector("#margin-height"))==null||n.setAttribute("value",c?c.margin.height.toString():"")}function Y(){function c(e){var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?`rgb(${parseInt(i[1],16)}, ${parseInt(i[2],16)}, ${parseInt(i[3],16)})`:null}return{lineWidth:.18,ratio:20,paperColor:c(W.value),mainOuterColor:c(D.value),remainInnerColor:c(M.value),mainInnerColor:c(B.value),remainOuterColor:c(F.value)}}function Z(){const o=[{source:{width:79,height:109},target:{width:22,height:32},margin:{width:2,height:3}},{source:{width:65,height:100},target:{width:43,height:12},margin:{width:1,height:1}},{source:{width:65,height:100},target:{width:23,height:12},margin:{width:1,height:1}},{source:{width:122,height:244},target:{width:43,height:12},margin:{width:1,height:1}},{source:{width:21,height:29.7},target:{width:8,height:12},margin:{width:.5,height:1}}],n=Math.floor(Math.random()*o.length);X(o[n])}function K(){I.style.display="none",A.style.display="none",Z();let c="base64-svg";[W,B,M,D,F].forEach(t=>{t.addEventListener("change",()=>{Y()})}),j.addEventListener("click",t=>{t.preventDefault(),console.log("calculate button triggered!"),J(c)}),N.addEventListener("change",t=>{t.preventDefault(),c=N.value})}function U(){const c=new FormData(E),t=Object.fromEntries(c);return{source:{width:Number(t["source-width"]),height:Number(t["source-height"])},target:{width:Number(t["target-width"]),height:Number(t["target-height"])},margin:{width:Number(t["margin-width"]),height:Number(t["margin-height"])}}}function L(c,t){I.style.display="block",A.style.display="inline-block",I.src=t,A.href=t,A.download=c}function J(c){var o,n,d;console.clear();let t,e,i,r="";try{const a=U();console.log(`Input Data (cm): 
Source : ${a.source.width} x ${a.source.height}
Target : ${a.target.width} x ${a.target.height}
Margin : ${(o=a.margin)==null?void 0:o.width} x ${(n=a.margin)==null?void 0:n.height}`),a.useInline=!1;const g=new G(a.source,a.target,a.margin,a.useInline);g.config=Y();const s=g.calculate();console.log(`Total Plotting (unit): 
Main   : ${s.main.length}
Remain : ${((d=s.remain)==null?void 0:d.length)||0}
Total  : ${s.total}`);const m=g.input,h=`Layout_Source_${m.source.width}x${m.source.height}_Target_${m.target.width}x${m.target.height}_Result_${s.total}`;for(;S.firstChild;)S.removeChild(S.firstChild);switch(c){case"svg-element":A.style.display="none",t=g.drawSvg(!1),e=t;break;case"base64-svg":i="svg",r=`${h}.${i}`,t=g.drawSvg(),e=I,L(r,t);break;case"canvas-element":A.style.display="none",t=g.drawCanvas(!1),e=t;break;case"base64-image":i="jpeg",r=`${h}.${i}`,t=g.drawCanvas(),e=I,L(r,t);break}S.appendChild(e),H.addEventListener("click",l=>{for(l.preventDefault(),console.log("Resetting Calculation!");S.firstChild;)S.removeChild(S.firstChild);g.reset(),X()})}catch(a){console.error(a),alert(a)}}K();
